<html>
<head>
<link rel="stylesheet" href="../dist/mapd3.css">
<style>

</style>
</head><body>
<div class="chart1"></div>
<div class="chart2"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
<script src="../dist/mapd3.min.js"></script>
<script>

/*
* stacked tooltip
* generator config: multiaxis
* single point line/area chart
* titles
* axes locking
* domain editor
*/

const keyType = "number" // time, number, string
const chartType = "line" // line, area, stackedArea

const dataManager = mapd3.DataManager()
    .setConfig({
      keyType,
      range: [0, 100],
      pointCount: 500,
      groupCount: 2
    })
const data = dataManager.generateTestDataset()

const observer = mapd3.Observer(dataManager)

const colors = mapd3.colors.mapdColors
const palette = data.series.map((d, i) => ({key: d.id, value: colors[i]}))

const chartNode1 = document.querySelector(".chart1")
const chart1 = mapd3.Line(chartNode1)
  .setConfig({
    width: 800,
    height: 400,
    margin: {
      top: 16,
      right: 32,
      bottom: 32,
      left: 32
    },
    grid: "horizontal",
    xAxisFormat: "%x",
    yAxisFormat: ".1f",
    yTicks: 5,
    colorSchema: palette,
    keyType,
    chartType,
    tickSkip: 20
  })
  .setData(data)

const chart1Tooltip = mapd3.Tooltip(chart1)

chart1Tooltip.setConfig({width: 1200})
  .render()

mapd3.Tooltip(chart1)

mapd3.Binning(chart1)
  .on("change", (d, info) => console.log(d, info))

const chart2 = mapd3.Line(".chart2")
  .setConfig({
    width: 800,
    height: 100,
    margin: {
      top: 8,
      right: 32,
      bottom: 32,
      left: 32
    },
    grid: "horizontal",
    xAxisFormat: "%x",
    yAxisFormat: ".1f",
    yTicks: 3,
    colorSchema: palette,
    keyType,
    chartType,
    tickSkip: 20
  })
  .setData(data)

const chart2Brush = mapd3.Brush(chart2)
chart2Brush.on("brushMove", (...arg) => {
  observer.pub("brushChange", ...arg)
})

// chart2.setData(data)
// chart2Brush.update()

observer.sub("dataFilter", (_data) => {
  chart1.setData(_data)
})

</script>
</body>
</html>